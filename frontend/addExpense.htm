<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add-Expense</title>
</head>
<body onload="getExpense()">
    <header id="main-header" class="bg-success text-white p-4 mb-3">
    <div class="container">
        <form id="newForm" class="form-inline mb-3">
        <label for="amount">Expense Amount</label>
        <input type="text" id="amount">
        <label for="description">Enter description</label>
        <input type="text" id="description">
        <label for="cat">Choose a category</label>
        <select id="cat">
            <option value="Movie">Movie</option>
            <option value="Food">Food</option>
            <option value="Transport">Transport</option>
            <option value="Personal">Personal</option>
        </select>
        <button type="submit" class="btn btn-dark" onclick="postExpense()">Add Expense</button>
    </form>
    <ul id="expense" class="expenseClass">
        
    </ul>
    <div id="newdiv"></div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>

    <script >
        function postExpense(){
            const obj = {
                amount:document.getElementById('amount').value,
                description:document.getElementById('description').value,
                cat:document.getElementById('cat').value,
                token:localStorage.getItem('token')
            }
            console.log(obj)
            axios.post('http://localhost:3000/expense/add-expense',obj,{headers:{'Authorization':localStorage.getItem('token')}})
            .then((expense)=>{
                console.log(expense)
            } 
            ).catch(e=>console.log(e))
        }
        async function getExpense(){
            const token=localStorage.getItem('token')
            const expenses = await axios.get('http://localhost:3000/expense/get-expense',{headers:{'Authorization':token}})
            
            expenses.data.forEach(expense=>{
                let li= document.createElement('li')
                li.class='detailsList';
                let rmvbutton=document.createElement('button')
                rmvbutton.id='remove'
                rmvbutton.innerText='Remove'
                rmvbutton.addEventListener('click',function(){
                    deleteExpense(expense.id)
                })
                
                let editbutton=document.createElement('button')
                editbutton.innerText='Edit'
                editbutton.id='edit'


                li.append(document.createTextNode(expense.expenseAmount+'-'),document.createTextNode(expense.description+'-'),document.createTextNode(expense.category+' '),rmvbutton,editbutton)
                
                let list=document.getElementById('expense')
                list.appendChild(li)
            })
        }
        function deleteExpense(id){
            const obj={
                id:id,
                token:localStorage.getItem('token')
            }
            axios.post('http://localhost:3000/expense/delete-expense',obj)
        }
    </script>
</body>
</html>